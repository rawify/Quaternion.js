/*
Quaternion.js v1.5.1 28/08/2023

Copyright (c) 2023, Robert Eisele (raw.org)
Licensed under the MIT license.
*/
(function(D){function n(a,b,d,f){var e=Object.create(q.prototype);e.w=a;e.x=b;e.y=d;e.z=f;return e}function v(a,b,d,f){var e=Object.create(q.prototype),g=1/Math.sqrt(a*a+b*b+d*d+f*f);e.w=a*g;e.x=b*g;e.y=d*g;e.z=f*g;return e}function A(a,b){var d=Math.abs(a),f=Math.abs(b);if(0===a)return Math.log(f);if(0===b)return Math.log(d);if(3E3>d&&3E3>f)return.5*Math.log(a*a+b*b);a/=2;b/=2;return.5*Math.log(a*a+b*b)+Math.LN2}function u(a,b,d,f,e){if(void 0!==e)a.w=b,a.x=d,a.y=f,a.z=e;else{if("object"===typeof b&&
void 0===f){if("w"in b||"x"in b||"y"in b||"z"in b){a.w=b.w||0;a.x=b.x||0;a.y=b.y||0;a.z=b.z||0;return}if("re"in b&&"im"in b){a.w=b.re;a.x=b.im;a.y=0;a.z=0;return}if(4===b.length){a.w=b[0];a.x=b[1];a.y=b[2];a.z=b[3];return}if(3===b.length){a.w=0;a.x=b[0];a.y=b[1];a.z=b[2];return}throw Error("Invalid object");}if("string"===typeof b&&void 0===f){b=b.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g);var g=1;d=0;f={i:"x",j:"y",k:"z"};if(null===b)throw Error("Parse error");for(e=a.w=a.x=a.y=a.z=0;e<b.length;e++){var h=
b[e],k=b[e+1];if(" "!==h&&"\t"!==h&&"\n"!==h)if("+"===h)g++;else if("-"===h)d++;else{if(0===g+d)throw Error("Parse error"+h);g=f[h];if(void 0!==g)" "===k||isNaN(k)?h="1":(h=k,e++);else{if(isNaN(h))throw Error("Parser error");g=f[k];void 0!==g&&e++}a[g||"w"]+=parseFloat((d%2?"-":"")+h);g=d=0}}if(0<g+d)throw Error("Parser error");}else void 0===b&&a!==l?(a.w=1,a.x=a.y=a.z=0):(a.w=b||0,d&&3===d.length?(a.x=d[0],a.y=d[1],a.z=d[2]):(a.x=d||0,a.y=f||0,a.z=e||0))}}function z(a,b,d){var f="";if(0!==a){""!==
d?f+=0>a?" - ":" + ":0>a&&(f+="-");a=Math.abs(a);if(1!==a||""===b)f+=a;f+=b}return f}function q(a,b,d,f){if(this instanceof q)u(this,a,b,d,f);else{var e=Object.create(q.prototype);u(e,a,b,d,f);return e}}var l=Object.create(q.prototype);q.prototype={w:1,x:0,y:0,z:0,add:function(a,b,d,f){u(l,a,b,d,f);return n(this.w+l.w,this.x+l.x,this.y+l.y,this.z+l.z)},sub:function(a,b,d,f){u(l,a,b,d,f);return n(this.w-l.w,this.x-l.x,this.y-l.y,this.z-l.z)},neg:function(){return n(-this.w,-this.x,-this.y,-this.z)},
norm:function(){var a=this.w,b=this.x,d=this.y,f=this.z;return Math.sqrt(a*a+b*b+d*d+f*f)},normSq:function(){var a=this.w,b=this.x,d=this.y,f=this.z;return a*a+b*b+d*d+f*f},normalize:function(){var a=this.w,b=this.x,d=this.y,f=this.z,e=Math.sqrt(a*a+b*b+d*d+f*f);if(1E-16>e)return q.ZERO;e=1/e;return n(a*e,b*e,d*e,f*e)},mul:function(a,b,d,f){u(l,a,b,d,f);a=this.w;b=this.x;d=this.y;f=this.z;var e=l.w,g=l.x,h=l.y,k=l.z;return n(a*e-b*g-d*h-f*k,a*g+b*e+d*k-f*h,a*h+d*e+f*g-b*k,a*k+f*e+b*h-d*g)},scale:function(a){return n(this.w*
a,this.x*a,this.y*a,this.z*a)},dot:function(a,b,d,f){u(l,a,b,d,f);return this.w*l.w+this.x*l.x+this.y*l.y+this.z*l.z},inverse:function(){var a=this.w,b=this.x,d=this.y,f=this.z,e=a*a+b*b+d*d+f*f;if(0===e)return q.ZERO;e=1/e;return n(a*e,-b*e,-d*e,-f*e)},div:function(a,b,d,f){u(l,a,b,d,f);a=this.w;b=this.x;d=this.y;f=this.z;var e=l.w,g=l.x,h=l.y,k=l.z,m=e*e+g*g+h*h+k*k;if(0===m)return q.ZERO;m=1/m;return n((a*e+b*g+d*h+f*k)*m,(b*e-a*g-d*k+f*h)*m,(d*e-a*h-f*g+b*k)*m,(f*e-a*k-b*h+d*g)*m)},conjugate:function(){return n(this.w,
-this.x,-this.y,-this.z)},exp:function(){var a=this.x,b=this.y,d=this.z,f=Math.sqrt(a*a+b*b+d*d),e=Math.exp(this.w),g=e*Math.sin(f)/f;return 0===f?n(e,0,0,0):n(e*Math.cos(f),a*g,b*g,d*g)},log:function(){var a=this.w,b=this.x,d=this.y,f=this.z;if(0===d&&0===f)return n(A(a,b),Math.atan2(b,a),0,0);var e=Math.sqrt(b*b+d*d+f*f);e=Math.atan2(e,a)/e;return n(.5*Math.log(b*b+d*d+f*f+a*a),b*e,d*e,f*e)},pow:function(a,b,d,f){u(l,a,b,d,f);if(0===l.y&&0===l.z){if(1===l.w&&0===l.x)return this;if(0===l.w&&0===
l.x)return q.ONE;if(0===this.y&&0===this.z){a=this.w;b=this.x;if(0===a&&0===b)return q.ZERO;d=Math.atan2(b,a);f=A(a,b);if(0===l.x){if(0===b&&0<=a)return n(Math.pow(a,l.w),0,0,0);if(0===a)switch(l.w%4){case 0:return n(Math.pow(b,l.w),0,0,0);case 1:return n(0,Math.pow(b,l.w),0,0);case 2:return n(-Math.pow(b,l.w),0,0,0);case 3:return n(0,-Math.pow(b,l.w),0,0)}}a=Math.exp(l.w*f-l.x*d);b=l.x*f+l.w*d;return n(a*Math.cos(b),a*Math.sin(b),0,0)}}return this.log().mul(l).exp()},equals:function(a,b,d,f){u(l,
a,b,d,f);return 1E-16>Math.abs(l.w-this.w)&&1E-16>Math.abs(l.x-this.x)&&1E-16>Math.abs(l.y-this.y)&&1E-16>Math.abs(l.z-this.z)},isFinite:function(){return isFinite(this.w)&&isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},isNaN:function(){return isNaN(this.w)||isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},toString:function(){var a=this.w,b=this.x,d=this.y,f=this.z;if(isNaN(a)||isNaN(b)||isNaN(d)||isNaN(f))return"NaN";a=z(a,"","");a+=z(b,"i",a);a+=z(d,"j",a);a+=z(f,"k",a);return""===a?"0":a},real:function(){return this.w},
imag:function(){return[this.x,this.y,this.z]},toVector:function(){return[this.w,this.x,this.y,this.z]},toMatrix:function(a){var b=this.w,d=this.x,f=this.y,e=this.z,g=b*d,h=b*f;b*=e;var k=d*d,m=d*f;d*=e;var p=f*f;f*=e;e*=e;return a?[[1-2*(p+e),2*(m-b),2*(d+h)],[2*(m+b),1-2*(k+e),2*(f-g)],[2*(d-h),2*(f+g),1-2*(k+p)]]:[1-2*(p+e),2*(m-b),2*(d+h),2*(m+b),1-2*(k+e),2*(f-g),2*(d-h),2*(f+g),1-2*(k+p)]},toMatrix4:function(a){var b=this.w,d=this.x,f=this.y,e=this.z,g=b*d,h=b*f;b*=e;var k=d*d,m=d*f;d*=e;var p=
f*f;f*=e;e*=e;return a?[[1-2*(p+e),2*(m-b),2*(d+h),0],[2*(m+b),1-2*(k+e),2*(f-g),0],[2*(d-h),2*(f+g),1-2*(k+p),0],[0,0,0,1]]:[1-2*(p+e),2*(m-b),2*(d+h),0,2*(m+b),1-2*(k+e),2*(f-g),0,2*(d-h),2*(f+g),1-2*(k+p),0,0,0,0,1]},toCSSTransform:function(){var a=this.w,b=2*Math.acos(a);a=1-a*a;1E-16>a?(b=0,a=1):a=1/Math.sqrt(a);return"rotate3d("+this.x*a+","+this.y*a+","+this.z*a+","+b+"rad)"},toAxisAngle:function(){var a=this.w,b=1-a*a;if(1E-16>b)return[[this.x,this.y,this.z],0];b=1/Math.sqrt(b);return[[this.x*
b,this.y*b,this.z*b],2*Math.acos(a)]},toEuler:function(a){function b(w){return 1<=w?Math.PI/2:-1>=w?-Math.PI/2:Math.asin(w)}var d=this.w,f=this.x,e=this.y,g=this.z,h=d*f,k=d*e;d*=g;var m=f*f,p=f*e;f*=g;var t=e*e;e*=g;g*=g;return void 0===a||"ZXY"===a?[-Math.atan2(2*(p-d),1-2*(m+g)),b(2*(e+h)),-Math.atan2(2*(f-k),1-2*(m+t))]:"XYZ"===a||"RPY"===a?[-Math.atan2(2*(e-h),1-2*(m+t)),b(2*(f+k)),-Math.atan2(2*(p-d),1-2*(t+g))]:"YXZ"===a?[Math.atan2(2*(f+k),1-2*(m+t)),-b(2*(e-h)),Math.atan2(2*(p+d),1-2*(m+
g))]:"ZYX"===a||"YPR"===a?[Math.atan2(2*(p+d),1-2*(t+g)),-b(2*(f-k)),Math.atan2(2*(e+h),1-2*(m+t))]:"YZX"===a?[-Math.atan2(2*(f-k),1-2*(t+g)),b(2*(p+d)),-Math.atan2(2*(e-h),1-2*(m+g))]:"XZY"===a?[Math.atan2(2*(e+h),1-2*(m+g)),-b(2*(p-d)),Math.atan2(2*(f+k),1-2*(t+g))]:null},clone:function(){return n(this.w,this.x,this.y,this.z)},rotateVector:function(a){var b=this.w,d=this.x,f=this.y,e=this.z,g=a[0],h=a[1];a=a[2];var k=2*(f*a-e*h),m=2*(e*g-d*a),p=2*(d*h-f*g);return[g+b*k+f*p-e*m,h+b*m+e*k-d*p,a+b*
p+d*m-f*k]},slerp:function(a,b,d,f){u(l,a,b,d,f);var e=this.w,g=this.x,h=this.y,k=this.z,m=l.w,p=l.x,t=l.y,w=l.z,y=e*m+g*p+h*t+k*w;0>y&&(e=-e,g=-g,h=-h,k=-k,y=-y);if(y>=1-1E-16)return function(r){return v(e+r*(m-e),g+r*(p-g),h+r*(t-h),k+r*(w-k))};var B=Math.acos(y),C=Math.sin(B);return function(r){var x=B*r;r=Math.sin(x);x=Math.cos(x)-y*r/C;r/=C;return n(x*e+r*m,x*g+r*p,x*h+r*t,x*k+r*w)}}};q.ZERO=n(0,0,0,0);q.ONE=n(1,0,0,0);q.I=n(0,1,0,0);q.J=n(0,0,1,0);q.K=n(0,0,0,1);q.fromAxisAngle=function(a,b){var d=
a[0],f=a[1],e=a[2],g=.5*b,h=Math.sin(g)/Math.sqrt(d*d+f*f+e*e);return n(Math.cos(g),d*h,f*h,e*h)};q.fromBetweenVectors=function(a,b){var d=a[0],f=a[1],e=a[2],g=b[0],h=b[1],k=b[2],m=Math.sqrt(d*d+f*f+e*e),p=Math.sqrt(g*g+h*h+k*k);0<m&&(d/=m,f/=m,e/=m);0<p&&(g/=p,h/=p,k/=p);m=d*g+f*h+e*k;return m>=1-1E-16?q.ONE:1E-16>=1+m?Math.abs(d)>Math.abs(e)?v(0,-f,d,0):v(0,0,-e,f):v(1+m,f*k-e*h,e*g-d*k,d*h-f*g)};q.random=function(){var a=Math.random(),b=Math.random(),d=Math.random(),f=Math.sqrt(1-a);a=Math.sqrt(a);
return n(a*Math.cos(2*Math.PI*d),f*Math.sin(2*Math.PI*b),f*Math.cos(2*Math.PI*b),a*Math.sin(2*Math.PI*d))};q.fromEulerLogical=function(a,b,d,f){return q.fromEuler(d,b,a,void 0!==f?f[2]+f[1]+f[0]:f)};q.fromEuler=function(a,b,d,f){var e=.5*a,g=.5*b,h=.5*d;d=Math.cos(e);b=Math.cos(g);a=Math.cos(h);e=Math.sin(e);g=Math.sin(g);h=Math.sin(h);return void 0===f||"ZXY"===f?n(d*b*a-e*g*h,g*d*a-e*h*b,e*g*a+h*d*b,e*b*a+g*h*d):"XYZ"===f||"RPY"===f?n(d*b*a-e*g*h,e*b*a+g*h*d,g*d*a-e*h*b,e*g*a+h*d*b):"YXZ"===f?n(e*
g*h+d*b*a,e*h*b+g*d*a,e*b*a-g*h*d,h*d*b-e*g*a):"ZYX"===f||"YPR"===f?n(e*g*h+d*b*a,h*d*b-e*g*a,e*h*b+g*d*a,e*b*a-g*h*d):"YZX"===f?n(d*b*a-e*g*h,e*g*a+h*d*b,e*b*a+g*h*d,g*d*a-e*h*b):"XZY"===f?n(e*g*h+d*b*a,e*b*a-g*h*d,h*d*b-e*g*a,e*h*b+g*d*a):"ZYZ"===f?n(d*b*a-e*h*b,g*h*d-e*g*a,e*g*h+g*d*a,e*b*a+h*d*b):"ZXZ"===f?n(d*b*a-e*h*b,e*g*h+g*d*a,e*g*a-g*h*d,e*b*a+h*d*b):"YXY"===f?n(d*b*a-e*h*b,e*g*h+g*d*a,e*b*a+h*d*b,g*h*d-e*g*a):"YZY"===f?n(d*b*a-e*h*b,e*g*a-g*h*d,e*b*a+h*d*b,e*g*h+g*d*a):"XYX"===f?n(d*b*
c-e*h*cYZ,e*b*a+h*d*b,e*g*h+g*d*a,e*g*a-g*h*d):"XZX"===f?n(d*b*a-e*h*b,e*b*a+h*d*b,g*h*d-e*g*a,e*g*h+g*d*a):null};q.fromMatrix=function(a){if(9===a.length){var b=a[0],d=a[1],f=a[2],e=a[3],g=a[4],h=a[5],k=a[6],m=a[7];a=a[8]}else b=a[0][0],d=a[0][1],f=a[0][2],e=a[1][0],g=a[1][1],h=a[1][2],k=a[2][0],m=a[2][1],a=a[2][2];var p=b+g+a;return 0<p?v(p+1,m-h,f-k,e-d):b>g&&b>a?v(m-h,1+b-g-a,d+e,f+k):g>a?v(f-k,d+e,1+g-b-a,h+m):v(e-d,f+k,h+m,1+a-b-g)};"object"===typeof exports?(Object.defineProperty(q,"__esModule",
{value:!0}),q["default"]=q,q.Quaternion=q,module.exports=q):D.Quaternion=q})(this);