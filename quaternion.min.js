/*
Quaternion.js v1.4.11 09/08/2023

Copyright (c) 2023, Robert Eisele (raw.org)
Licensed under the MIT license.
*/
(function(C){function m(a,b,c,d){var e=Object.create(p.prototype);e.w=a;e.x=b;e.y=c;e.z=d;return e}function x(a,b,c,d){var e=Object.create(p.prototype),f=1/Math.sqrt(a*a+b*b+c*c+d*d);e.w=a*f;e.x=b*f;e.y=c*f;e.z=d*f;return e}function z(a,b){var c=Math.abs(a),d=Math.abs(b);if(0===a)return Math.log(d);if(0===b)return Math.log(c);if(3E3>c&&3E3>d)return.5*Math.log(a*a+b*b);a/=2;b/=2;return.5*Math.log(a*a+b*b)+Math.LN2}function t(a,b,c,d,e){if(void 0!==e)a.w=b,a.x=c,a.y=d,a.z=e;else{if("object"===typeof b&&
void 0===d){if("w"in b||"x"in b||"y"in b||"z"in b){a.w=b.w||0;a.x=b.x||0;a.y=b.y||0;a.z=b.z||0;return}if("re"in b&&"im"in b){a.w=b.re;a.x=b.im;a.y=0;a.z=0;return}if(4===b.length){a.w=b[0];a.x=b[1];a.y=b[2];a.z=b[3];return}if(3===b.length){a.w=0;a.x=b[0];a.y=b[1];a.z=b[2];return}throw Error("Invalid object");}if("string"===typeof b&&void 0===d){b=b.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g);var f=1;c=0;d={i:"x",j:"y",k:"z"};if(null===b)throw Error("Parse error");for(e=a.w=a.x=a.y=a.z=0;e<b.length;e++){var g=
b[e],h=b[e+1];if(" "!==g&&"\t"!==g&&"\n"!==g)if("+"===g)f++;else if("-"===g)c++;else{if(0===f+c)throw Error("Parse error"+g);f=d[g];if(void 0!==f)" "===h||isNaN(h)?g="1":(g=h,e++);else{if(isNaN(g))throw Error("Parser error");f=d[h];void 0!==f&&e++}a[f||"w"]+=parseFloat((c%2?"-":"")+g);f=c=0}}if(0<f+c)throw Error("Parser error");}else void 0===b&&a!==k?(a.w=1,a.x=a.y=a.z=0):(a.w=b||0,c&&3===c.length?(a.x=c[0],a.y=c[1],a.z=c[2]):(a.x=c||0,a.y=d||0,a.z=e||0))}}function y(a,b,c){var d="";if(0!==a){""!==
c?d+=0>a?" - ":" + ":0>a&&(d+="-");a=Math.abs(a);if(1!==a||""===b)d+=a;d+=b}return d}function p(a,b,c,d){if(this instanceof p)t(this,a,b,c,d);else{var e=Object.create(p.prototype);t(e,a,b,c,d);return e}}var k=Object.create(p.prototype);p.prototype={w:1,x:0,y:0,z:0,add:function(a,b,c,d){t(k,a,b,c,d);return m(this.w+k.w,this.x+k.x,this.y+k.y,this.z+k.z)},sub:function(a,b,c,d){t(k,a,b,c,d);return m(this.w-k.w,this.x-k.x,this.y-k.y,this.z-k.z)},neg:function(){return m(-this.w,-this.x,-this.y,-this.z)},
norm:function(){var a=this.w,b=this.x,c=this.y,d=this.z;return Math.sqrt(a*a+b*b+c*c+d*d)},normSq:function(){var a=this.w,b=this.x,c=this.y,d=this.z;return a*a+b*b+c*c+d*d},normalize:function(){var a=this.w,b=this.x,c=this.y,d=this.z,e=Math.sqrt(a*a+b*b+c*c+d*d);if(1E-16>e)return p.ZERO;e=1/e;return m(a*e,b*e,c*e,d*e)},mul:function(a,b,c,d){t(k,a,b,c,d);a=this.w;b=this.x;c=this.y;d=this.z;var e=k.w,f=k.x,g=k.y,h=k.z;return m(a*e-b*f-c*g-d*h,a*f+b*e+c*h-d*g,a*g+c*e+d*f-b*h,a*h+d*e+b*g-c*f)},scale:function(a){return m(this.w*
a,this.x*a,this.y*a,this.z*a)},dot:function(a,b,c,d){t(k,a,b,c,d);return this.w*k.w+this.x*k.x+this.y*k.y+this.z*k.z},inverse:function(){var a=this.w,b=this.x,c=this.y,d=this.z,e=a*a+b*b+c*c+d*d;if(0===e)return p.ZERO;e=1/e;return m(a*e,-b*e,-c*e,-d*e)},div:function(a,b,c,d){t(k,a,b,c,d);a=this.w;b=this.x;c=this.y;d=this.z;var e=k.w,f=k.x,g=k.y,h=k.z,l=e*e+f*f+g*g+h*h;if(0===l)return p.ZERO;l=1/l;return m((a*e+b*f+c*g+d*h)*l,(b*e-a*f-c*h+d*g)*l,(c*e-a*g-d*f+b*h)*l,(d*e-a*h-b*g+c*f)*l)},conjugate:function(){return m(this.w,
-this.x,-this.y,-this.z)},exp:function(){var a=this.x,b=this.y,c=this.z,d=Math.sqrt(a*a+b*b+c*c),e=Math.exp(this.w),f=e/d*Math.sin(d);return 0===d?m(e,0,0,0):m(e*Math.cos(d),a*f,b*f,c*f)},log:function(){var a=this.w,b=this.x,c=this.y,d=this.z;if(0===c&&0===d)return m(z(a,b),Math.atan2(b,a),0,0);var e=Math.sqrt(b*b+c*c+d*d);e=Math.atan2(e,a)/e;return m(.5*Math.log(b*b+c*c+d*d+a*a),b*e,c*e,d*e)},pow:function(a,b,c,d){t(k,a,b,c,d);if(0===k.y&&0===k.z){if(1===k.w&&0===k.x)return this;if(0===k.w&&0===
k.x)return p.ONE;if(0===this.y&&0===this.z){a=this.w;b=this.x;if(0===a&&0===b)return p.ZERO;c=Math.atan2(b,a);d=z(a,b);if(0===k.x){if(0===b&&0<=a)return m(Math.pow(a,k.w),0,0,0);if(0===a)switch(k.w%4){case 0:return m(Math.pow(b,k.w),0,0,0);case 1:return m(0,Math.pow(b,k.w),0,0);case 2:return m(-Math.pow(b,k.w),0,0,0);case 3:return m(0,-Math.pow(b,k.w),0,0)}}a=Math.exp(k.w*d-k.x*c);b=k.x*d+k.w*c;return m(a*Math.cos(b),a*Math.sin(b),0,0)}}return this.log().mul(k).exp()},equals:function(a,b,c,d){t(k,
a,b,c,d);return 1E-16>Math.abs(k.w-this.w)&&1E-16>Math.abs(k.x-this.x)&&1E-16>Math.abs(k.y-this.y)&&1E-16>Math.abs(k.z-this.z)},isFinite:function(){return isFinite(this.w)&&isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},isNaN:function(){return isNaN(this.w)||isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},toString:function(){var a=this.w,b=this.x,c=this.y,d=this.z;if(isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d))return"NaN";a=y(a,"","");a+=y(b,"i",a);a+=y(c,"j",a);a+=y(d,"k",a);return""===a?"0":a},real:function(){return this.w},
imag:function(){return[this.x,this.y,this.z]},toVector:function(){return[this.w,this.x,this.y,this.z]},toMatrix:function(a){var b=this.w,c=this.x,d=this.y,e=this.z,f=b*c,g=b*d;b*=e;var h=c*c,l=c*d;c*=e;var n=d*d;d*=e;e*=e;return a?[[1-2*(n+e),2*(l-b),2*(c+g)],[2*(l+b),1-2*(h+e),2*(d-f)],[2*(c-g),2*(d+f),1-2*(h+n)]]:[1-2*(n+e),2*(l-b),2*(c+g),2*(l+b),1-2*(h+e),2*(d-f),2*(c-g),2*(d+f),1-2*(h+n)]},toMatrix4:function(a){var b=this.w,c=this.x,d=this.y,e=this.z,f=b*c,g=b*d;b*=e;var h=c*c,l=c*d;c*=e;var n=
d*d;d*=e;e*=e;return a?[[1-2*(n+e),2*(l-b),2*(c+g),0],[2*(l+b),1-2*(h+e),2*(d-f),0],[2*(c-g),2*(d+f),1-2*(h+n),0],[0,0,0,1]]:[1-2*(n+e),2*(l-b),2*(c+g),0,2*(l+b),1-2*(h+e),2*(d-f),0,2*(c-g),2*(d+f),1-2*(h+n),0,0,0,0,1]},toCSSTransform:function(){var a=this.w,b=this.x,c=this.y,d=this.z,e=a*b,f=a*c;a*=d;var g=b*b,h=b*c;b*=d;var l=c*c;c*=d;d*=d;return"matrix3d("+[1-2*(l+d),2*(h+a),2*(b-f),0,2*(h-a),1-2*(g+d),2*(c+e),0,2*(b+f),2*(c-e),1-2*(g+l),0,0,0,0,1].join()+")"},toAxisAngle:function(){var a=this.w,
b=2*Math.acos(a);a=Math.sqrt(1-a*a);if(1E-16>a)return[[this.x,this.y,this.z],0];a=1/a;return[[this.x*a,this.y*a,this.z*a],b]},toEuler:function(a){function b(u){return 1<=u?Math.PI/2:-1>=u?-Math.PI/2:Math.asin(u)}var c=this.w,d=this.x,e=this.y,f=this.z,g=c*d,h=c*e;c*=f;var l=d*d,n=d*e;d*=f;var r=e*e;e*=f;f*=f;return void 0===a||"ZXY"===a?[-Math.atan2(2*(n-c),1-2*(l+f)),b(2*(e+g)),-Math.atan2(2*(d-h),1-2*(l+r))]:"XYZ"===a?[-Math.atan2(2*(e-g),1-2*(l+r)),b(2*(d+h)),-Math.atan2(2*(n-c),1-2*(r+f))]:"YXZ"===
a?[Math.atan2(2*(d+h),1-2*(l+r)),-b(2*(e-g)),Math.atan2(2*(n+c),1-2*(l+f))]:"ZYX"===a||"RPY"===a?[Math.atan2(2*(n+c),1-2*(r+f)),-b(2*(d-h)),Math.atan2(2*(e+g),1-2*(l+r))]:"YZX"===a?[-Math.atan2(2*(d-h),1-2*(r+f)),b(2*(n+c)),-Math.atan2(2*(e-g),1-2*(l+f))]:"XZY"===a?[Math.atan2(2*(e+g),1-2*(l+f)),-b(2*(n-c)),Math.atan2(2*(d+h),1-2*(r+f))]:null},clone:function(){return m(this.w,this.x,this.y,this.z)},rotateVector:function(a){var b=this.w,c=this.x,d=this.y,e=this.z,f=a[0],g=a[1];a=a[2];var h=2*(d*a-
e*g),l=2*(e*f-c*a),n=2*(c*g-d*f);return[f+b*h+d*n-e*l,g+b*l+e*h-c*n,a+b*n+c*l-d*h]},slerp:function(a,b,c,d){t(k,a,b,c,d);var e=this.w,f=this.x,g=this.y,h=this.z,l=k.w,n=k.x,r=k.y,u=k.z,w=e*l+f*n+g*r+h*u;0>w&&(e=-e,f=-f,g=-g,h=-h,w=-w);if(w>=1-1E-16)return function(q){return x(e+q*(l-e),f+q*(n-f),g+q*(r-g),h+q*(u-h))};var A=Math.acos(w),B=Math.sin(A);return function(q){var v=A*q;q=Math.sin(v);v=Math.cos(v)-w*q/B;q/=B;return m(v*e+q*l,v*f+q*n,v*g+q*r,v*h+q*u)}}};p.ZERO=m(0,0,0,0);p.ONE=m(1,0,0,0);p.I=
m(0,1,0,0);p.J=m(0,0,1,0);p.K=m(0,0,0,1);p.fromAxisAngle=function(a,b){var c=a[0],d=a[1],e=a[2],f=.5*b,g=Math.sin(f)/Math.sqrt(c*c+d*d+e*e);return m(Math.cos(f),c*g,d*g,e*g)};p.fromBetweenVectors=function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2],l=Math.sqrt(c*c+d*d+e*e),n=Math.sqrt(f*f+g*g+h*h);0<l&&(c/=l,d/=l,e/=l);0<n&&(f/=n,g/=n,h/=n);l=c*f+d*g+e*h;return l>=1-1E-16?p.ONE:1E-16>=1+l?Math.abs(c)>Math.abs(e)?x(0,-d,c,0):x(0,0,-e,d):x(1+l,d*h-e*g,e*f-c*h,c*g-d*f)};p.random=function(){var a=
Math.random(),b=Math.random(),c=Math.random(),d=Math.sqrt(1-a);a=Math.sqrt(a);return m(a*Math.cos(2*Math.PI*c),d*Math.sin(2*Math.PI*b),d*Math.cos(2*Math.PI*b),a*Math.sin(2*Math.PI*c))};p.fromEuler=function(a,b,c,d){var e=.5*a,f=.5*b,g=.5*c;c=Math.cos(e);b=Math.cos(f);a=Math.cos(g);e=Math.sin(e);f=Math.sin(f);g=Math.sin(g);return void 0===d||"ZXY"===d?m(c*b*a-e*f*g,f*c*a-e*g*b,e*f*a+g*c*b,e*b*a+f*g*c):"XYZ"===d?m(c*b*a-e*f*g,e*b*a+f*g*c,f*c*a-e*g*b,e*f*a+g*c*b):"YXZ"===d?m(e*f*g+c*b*a,e*g*b+f*c*a,
e*b*a-f*g*c,g*c*b-e*f*a):"ZYX"===d||"RPY"===d?m(e*f*g+c*b*a,g*c*b-e*f*a,e*g*b+f*c*a,e*b*a-f*g*c):"YZX"===d?m(c*b*a-e*f*g,e*f*a+g*c*b,e*b*a+f*g*c,f*c*a-e*g*b):"XZY"===d?m(e*f*g+c*b*a,e*b*a-f*g*c,g*c*b-e*f*a,e*g*b+f*c*a):null};p.fromMatrix=function(a){if(9===a.length){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],l=a[7];a=a[8]}else b=a[0][0],c=a[0][1],d=a[0][2],e=a[1][0],f=a[1][1],g=a[1][2],h=a[2][0],l=a[2][1],a=a[2][2];var n=b+f+a;if(0<n)return b=2*Math.sqrt(n+1),m(.25*b,(l-g)/b,(d-h)/b,(e-
c)/b);if(b>f&b>a)return b=2*Math.sqrt(1+b-f-a),m((l-g)/b,.25*b,(c+e)/b,(d+h)/b);if(f>a)return b=2*Math.sqrt(1+f-b-a),m((d-h)/b,(c+e)/b,.25*b,(g+l)/b);b=2*Math.sqrt(1+a-b-f);return m((e-c)/b,(d+h)/b,(g+l)/b,.25*b)};"function"===typeof define&&define.amd?define([],function(){return p}):"object"===typeof exports?(Object.defineProperty(p,"__esModule",{value:!0}),p["default"]=p,p.Quaternion=p,module.exports=p):C.Quaternion=p})(this);