/*
Quaternion.js v1.4.5 12/03/2023

Copyright (c) 2023, Robert Eisele (raw.org)
Licensed under the MIT license.
*/
(function(B){function l(a,b,c,e){var d=Object.create(n.prototype);d.w=a;d.x=b;d.y=c;d.z=e;return d}function y(a,b){var c=Math.abs(a),e=Math.abs(b);if(0===a)return Math.log(e);if(0===b)return Math.log(c);if(3E3>c&&3E3>e)return.5*Math.log(a*a+b*b);a/=2;b/=2;return.5*Math.log(a*a+b*b)+Math.LN2}function r(a,b,c,e,d){if(void 0!==d)a.w=b,a.x=c,a.y=e,a.z=d;else{if("object"===typeof b&&void 0===e){if("w"in b||"x"in b||"y"in b||"z"in b){a.w=b.w||0;a.x=b.x||0;a.y=b.y||0;a.z=b.z||0;return}if("re"in b&&"im"in
b){a.w=b.re;a.x=b.im;a.y=0;a.z=0;return}if(4===b.length){a.w=b[0];a.x=b[1];a.y=b[2];a.z=b[3];return}if(3===b.length){a.w=0;a.x=b[0];a.y=b[1];a.z=b[2];return}throw Error("Invalid object");}if("string"===typeof b&&void 0===e){b=b.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g);var f=1;c=0;e={i:"x",j:"y",k:"z"};if(null===b)throw Error("Parse error");for(d=a.w=a.x=a.y=a.z=0;d<b.length;d++){var g=b[d],k=b[d+1];if(" "!==g&&"\t"!==g&&"\n"!==g)if("+"===g)f++;else if("-"===g)c++;else{if(0===f+c)throw Error("Parse error"+
g);f=e[g];if(void 0!==f)" "===k||isNaN(k)?g="1":(g=k,d++);else{if(isNaN(g))throw Error("Parser error");f=e[k];void 0!==f&&d++}a[f||"w"]+=parseFloat((c%2?"-":"")+g);f=c=0}}if(0<f+c)throw Error("Parser error");}else void 0===b&&a!==h?(a.w=1,a.x=a.y=a.z=0):(a.w=b||0,c&&3===c.length?(a.x=c[0],a.y=c[1],a.z=c[2]):(a.x=c||0,a.y=e||0,a.z=d||0))}}function v(a,b,c){var e="";if(0!==a){""!==c?e+=0>a?" - ":" + ":0>a&&(e+="-");a=Math.abs(a);if(1!==a||""===b)e+=a;e+=b}return e}function n(a,b,c,e){if(this instanceof
n)r(this,a,b,c,e);else{var d=Object.create(n.prototype);r(d,a,b,c,e);return d}}var h=Object.create(n.prototype);n.prototype={w:1,x:0,y:0,z:0,add:function(a,b,c,e){r(h,a,b,c,e);return l(this.w+h.w,this.x+h.x,this.y+h.y,this.z+h.z)},sub:function(a,b,c,e){r(h,a,b,c,e);return l(this.w-h.w,this.x-h.x,this.y-h.y,this.z-h.z)},neg:function(){return l(-this.w,-this.x,-this.y,-this.z)},norm:function(){var a=this.w,b=this.x,c=this.y,e=this.z;return Math.sqrt(a*a+b*b+c*c+e*e)},normSq:function(){var a=this.w,
b=this.x,c=this.y,e=this.z;return a*a+b*b+c*c+e*e},normalize:function(){var a=this.w,b=this.x,c=this.y,e=this.z,d=Math.sqrt(a*a+b*b+c*c+e*e);if(1E-16>d)return n.ZERO;d=1/d;return l(a*d,b*d,c*d,e*d)},mul:function(a,b,c,e){r(h,a,b,c,e);a=this.w;b=this.x;c=this.y;e=this.z;var d=h.w,f=h.x,g=h.y,k=h.z;return l(a*d-b*f-c*g-e*k,a*f+b*d+c*k-e*g,a*g+c*d+e*f-b*k,a*k+e*d+b*g-c*f)},scale:function(a){return l(this.w*a,this.x*a,this.y*a,this.z*a)},dot:function(a,b,c,e){r(h,a,b,c,e);return this.w*h.w+this.x*h.x+
this.y*h.y+this.z*h.z},inverse:function(){var a=this.w,b=this.x,c=this.y,e=this.z,d=a*a+b*b+c*c+e*e;if(0===d)return n.ZERO;d=1/d;return l(a*d,-b*d,-c*d,-e*d)},div:function(a,b,c,e){r(h,a,b,c,e);a=this.w;b=this.x;c=this.y;e=this.z;var d=h.w,f=h.x,g=h.y,k=h.z,m=d*d+f*f+g*g+k*k;if(0===m)return n.ZERO;m=1/m;return l((a*d+b*f+c*g+e*k)*m,(b*d-a*f-c*k+e*g)*m,(c*d-a*g-e*f+b*k)*m,(e*d-a*k-b*g+c*f)*m)},conjugate:function(){return l(this.w,-this.x,-this.y,-this.z)},exp:function(){var a=this.x,b=this.y,c=this.z,
e=Math.sqrt(a*a+b*b+c*c),d=Math.exp(this.w),f=d/e*Math.sin(e);return 0===e?l(d,0,0,0):l(d*Math.cos(e),a*f,b*f,c*f)},log:function(){var a=this.w,b=this.x,c=this.y,e=this.z;if(0===c&&0===e)return l(y(a,b),Math.atan2(b,a),0,0);var d=Math.sqrt(b*b+c*c+e*e);d=Math.atan2(d,a)/d;return l(.5*Math.log(b*b+c*c+e*e+a*a),b*d,c*d,e*d)},pow:function(a,b,c,e){r(h,a,b,c,e);if(0===h.y&&0===h.z){if(1===h.w&&0===h.x)return this;if(0===h.w&&0===h.x)return n.ONE;if(0===this.y&&0===this.z){a=this.w;b=this.x;if(0===a&&
0===b)return n.ZERO;c=Math.atan2(b,a);e=y(a,b);if(0===h.x){if(0===b&&0<=a)return l(Math.pow(a,h.w),0,0,0);if(0===a)switch(h.w%4){case 0:return l(Math.pow(b,h.w),0,0,0);case 1:return l(0,Math.pow(b,h.w),0,0);case 2:return l(-Math.pow(b,h.w),0,0,0);case 3:return l(0,-Math.pow(b,h.w),0,0)}}a=Math.exp(h.w*e-h.x*c);b=h.x*e+h.w*c;return l(a*Math.cos(b),a*Math.sin(b),0,0)}}return this.log().mul(h).exp()},equals:function(a,b,c,e){r(h,a,b,c,e);return 1E-16>Math.abs(h.w-this.w)&&1E-16>Math.abs(h.x-this.x)&&
1E-16>Math.abs(h.y-this.y)&&1E-16>Math.abs(h.z-this.z)},isFinite:function(){return isFinite(this.w)&&isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},isNaN:function(){return isNaN(this.w)||isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},toString:function(){var a=this.w,b=this.x,c=this.y,e=this.z;if(isNaN(a)||isNaN(b)||isNaN(c)||isNaN(e))return"NaN";a=v(a,"","");a+=v(b,"i",a);a+=v(c,"j",a);a+=v(e,"k",a);return""===a?"0":a},real:function(){return this.w},imag:function(){return[this.x,this.y,this.z]},
toVector:function(){return[this.w,this.x,this.y,this.z]},toMatrix:function(a){var b=this.w,c=this.x,e=this.y,d=this.z,f=b*c,g=b*e;b*=d;var k=c*c,m=c*e;c*=d;var p=e*e;e*=d;d*=d;return a?[[1-2*(p+d),2*(m-b),2*(c+g)],[2*(m+b),1-2*(k+d),2*(e-f)],[2*(c-g),2*(e+f),1-2*(k+p)]]:[1-2*(p+d),2*(m-b),2*(c+g),2*(m+b),1-2*(k+d),2*(e-f),2*(c-g),2*(e+f),1-2*(k+p)]},toMatrix4:function(a){var b=this.w,c=this.x,e=this.y,d=this.z,f=b*c,g=b*e;b*=d;var k=c*c,m=c*e;c*=d;var p=e*e;e*=d;d*=d;return a?[[1-2*(p+d),2*(m-b),
2*(c+g),0],[2*(m+b),1-2*(k+d),2*(e-f),0],[2*(c-g),2*(e+f),1-2*(k+p),0],[0,0,0,1]]:[1-2*(p+d),2*(m-b),2*(c+g),0,2*(m+b),1-2*(k+d),2*(e-f),0,2*(c-g),2*(e+f),1-2*(k+p),0,0,0,0,1]},toAxisAngle:function(){var a=this.w,b=2*Math.acos(a);a=Math.sqrt(1-a*a);a=1E-16>a?1:1/a;return[[this.x*a,this.y*a,this.z*a],b]},toEuler:function(a){function b(g){return 1<=g?Math.PI/2:-1>=g?-Math.PI/2:Math.asin(g)}var c=this.w,e=this.x,d=this.y,f=this.z;return void 0===a||"ZXY"===a?{roll:Math.atan2(2*(c*d-e*f),c*c-e*e-d*d+
f*f),pitch:b(2*(d*f+c*e)),yaw:Math.atan2(2*(c*f-e*d),c*c-e*e+d*d-f*f)}:"XYZ"===a?{roll:Math.atan2(2*(c*f-e*d),c*c+e*e-d*d-f*f),pitch:b(2*(e*f+c*d)),yaw:Math.atan2(2*(c*e-d*f),c*c-e*e-d*d+f*f)}:"YXZ"===a?{roll:Math.atan2(2*(e*d+c*f),c*c-e*e+d*d-f*f),pitch:b(2*(c*e-d*f)),yaw:Math.atan2(2*(e*f+c*d),c*c-e*e-d*d+f*f)}:"ZYX"===a?{roll:Math.atan2(2*(c*e+d*f),1-2*(e*e+d*d)),pitch:b(2*(c*d-e*f)),yaw:Math.atan2(2*(e*d+c*f),1-2*(d*d+f*f))}:"YZX"===a?{roll:Math.atan2(2*(c*e-d*f),c*c-e*e+d*d-f*f),pitch:b(2*(e*
d+c*f)),yaw:Math.atan2(2*(c*d-e*f),c*c+e*e-d*d-f*f)}:"XZY"===a?{roll:Math.atan2(2*(e*f+c*d),c*c+e*e-d*d-f*f),pitch:b(2*(c*f-e*d)),yaw:Math.atan2(2*(d*f+c*e),c*c-e*e+d*d-f*f)}:null},clone:function(){return l(this.w,this.x,this.y,this.z)},rotateVector:function(a){var b=this.w,c=this.x,e=this.y,d=this.z,f=a[0],g=a[1];a=a[2];var k=2*(e*a-d*g),m=2*(d*f-c*a),p=2*(c*g-e*f);return[f+b*k+e*p-d*m,g+b*m+d*k-c*p,a+b*p+c*m-e*k]},slerp:function(a,b,c,e){r(h,a,b,c,e);var d=this.w,f=this.x,g=this.y,k=this.z,m=h.w,
p=h.x,w=h.y,x=h.z,u=d*m+f*p+g*w+k*x;0>u&&(d=-d,f=-f,g=-g,k=-k,u=-u);if(u>=1-1E-16)return function(q){return l(d+q*(m-d),f+q*(p-f),g+q*(w-g),k+q*(x-k)).normalize()};var z=Math.acos(u),A=Math.sin(z);return function(q){var t=z*q;q=Math.sin(t);t=Math.cos(t)-u*q/A;q/=A;return l(t*d+q*m,t*f+q*p,t*g+q*w,t*k+q*x)}}};n.ZERO=l(0,0,0,0);n.ONE=l(1,0,0,0);n.I=l(0,1,0,0);n.J=l(0,0,1,0);n.K=l(0,0,0,1);n.fromAxisAngle=function(a,b){var c=a[0],e=a[1],d=a[2],f=.5*b,g=Math.sin(f)/Math.sqrt(c*c+e*e+d*d);return l(Math.cos(f),
c*g,e*g,d*g)};n.fromBetweenVectors=function(a,b){var c=a[0],e=a[1],d=a[2],f=b[0],g=b[1],k=b[2],m=Math.sqrt(c*c+e*e+d*d),p=Math.sqrt(f*f+g*g+k*k);0<m&&(c/=m,e/=m,d/=m);0<p&&(f/=p,g/=p,k/=p);m=c*f+e*g+d*k;return m>=1-1E-16?n.ONE:1E-16>=1+m?n.fromAxisAngle(Math.abs(c)>Math.abs(d)?[-e,c,0]:[0,-d,e],Math.PI):l(1+m,e*k-d*g,d*f-c*k,c*g-e*f).normalize()};n.random=function(){var a=Math.random(),b=Math.random(),c=Math.random(),e=Math.sqrt(1-a);a=Math.sqrt(a);return l(a*Math.cos(2*Math.PI*c),e*Math.sin(2*Math.PI*
b),e*Math.cos(2*Math.PI*b),a*Math.sin(2*Math.PI*c))};n.fromEuler=function(a,b,c,e){var d=.5*a,f=.5*b,g=.5*c;c=Math.cos(d);b=Math.cos(f);a=Math.cos(g);d=Math.sin(d);f=Math.sin(f);g=Math.sin(g);return void 0===e||"ZXY"===e?l(c*b*a-d*f*g,c*a*f-b*d*g,c*b*g+a*d*f,b*a*d+c*f*g):"XYZ"===e||"RPY"===e?l(c*b*a-d*f*g,b*a*d+c*f*g,c*a*f-b*d*g,c*b*g+a*d*f):"YXZ"===e?l(c*b*a+d*f*g,c*a*f+b*d*g,b*a*d-c*f*g,c*b*g-a*d*f):"ZYX"===e||"YPR"===e?l(c*b*a+d*f*g,c*b*g-a*d*f,c*a*f+b*d*g,b*a*d-c*f*g):"YZX"===e?l(c*b*a-d*f*g,
c*b*g+a*d*f,b*a*d+c*f*g,c*a*f-b*d*g):"XZY"===e?l(c*b*a+d*f*g,b*a*d-c*f*g,c*b*g-a*d*f,c*a*f+b*d*g):null};n.fromMatrix=function(a){if(9===a.length){var b=a[0],c=a[1],e=a[2],d=a[3],f=a[4],g=a[5],k=a[6],m=a[7];a=a[8]}else b=a[0][0],c=a[0][1],e=a[0][2],d=a[1][0],f=a[1][1],g=a[1][2],k=a[2][0],m=a[2][1],a=a[2][2];var p=b+f+a;if(0<p)return b=2*Math.sqrt(p+1),l(.25*b,(m-g)/b,(e-k)/b,(d-c)/b);if(b>f&b>a)return b=2*Math.sqrt(1+b-f-a),l((m-g)/b,.25*b,(c+d)/b,(e+k)/b);if(f>a)return b=2*Math.sqrt(1+f-b-a),l((e-
k)/b,(c+d)/b,.25*b,(g+m)/b);b=2*Math.sqrt(1+a-b-f);return l((d-c)/b,(e+k)/b,(g+m)/b,.25*b)};"function"===typeof define&&define.amd?define([],function(){return n}):"object"===typeof exports?(Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=n,n.Quaternion=n,module.exports=n):B.Quaternion=n})(this);
